$choco = "https://chocolatey.org/install.ps1"

$githubs = "https://github.com/PowerShellMafia/PowerSploit.git",
	"https://github.com/LordNem/ADTools.git",
	"https://github.com/BloodHoundAD/BloodHound.git"

$features = "TelnetClient", 
	"NetFx3"

######
Import-Module BitsTransfer

# Directories
mkdir c:\install\ -erroraction silentlycontinue
mkdir c:\pentest\ -erroraction silentlycontinue

# disable defender
Set-MpPreference -DisableRealtimeMonitoring $true

# Chocolatey
write-host "Installing Chocolatey"
(New-Object System.Net.WebClient).DownloadFile( $choco, "c:\install\choco.ps1" )
$env:chocolateyUseWindowsCompression = 'true'
& c:\install\choco.ps1

# Windows terminal
choco install microsoft-windows-terminal -y

# 7-zip
write-host "Installing 7-zip"
choco install 7zip -y

# Notepad ++
write-host "Installing Notepad++"
choco install notepadplusplus -y

# Advanced IP Scanner
write-host "Installing Advanced IP Scanner"
choco install advanced-ip-scanner -y

# Chrome
write-host "Installing chrome"
choco install googlechrome -y

# git
write-host "Installing git"
choco install git -y

# sysinternals
write-host "Installing Sysinternals"
choco install sysinternals --params "/InstallDir:C:\pentest\sysinternals" -y

# Defender Exclusions
# note, disabling Defender via Set-MpPreference doesn't seem to persist at this point
write-host "Configuring Defender"
Set-MpPreference -ExclusionPath "c:\pentest"

# Git Repos
$githubs | % {
	cd \pentest
	write-host "Cloning $_"
	Start-Process 'C:\Program Files\Git\bin\git.exe' -ArgumentList "clone $_" -nonewwindow -wait
}

# Features
$features | % {
	write-host "Installing $_"
	Enable-WindowsOptionalFeature -online -featurename $_ -norestart -All
}

# Developer mode
write-host "Enabling Developer mode"
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\AppModelUnlock" /t REG_DWORD /f /v "AllowDevelopmentWithoutDevLicense" /d "1"
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\AppModelUnlock" /t REG_DWORD /f /v "AllowAllTrustedApps" /d "1"

# RSAT
write-host "Installing RSAT"
choco install rsat -y

# disable fast startup
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Power" /V HiberbootEnabled /T REG_dWORD /D 0 /F

write-host "Installs completed"
